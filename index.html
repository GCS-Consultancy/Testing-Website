<section id="our-team">
    <div class="container mx-auto px-4">
        <h2 class="text-4xl font-extrabold section-heading">Our Team</h2>
        <p class="text-lg text-gray-700 max-w-3xl mx-auto mb-12">
            Our dedicated team is at the heart of everything we do, bringing expertise and passion to every project. We're proud to highlight our talented developers who are instrumental in bringing your vision to life.
        </p>

        <div class="team-members-carousel-container">
            <div class="team-members-track flex transition-transform duration-500 ease-in-out" id="teamMembersTrack">
                <p class="p-8">Loading team members...</p>
            </div>
            <button class="carousel-button prev" id="prevTeamBtn">&#10094;</button>
            <button class="carousel-button next" id="nextTeamBtn">&#10095;</button>
        </div>
        <div class="carousel-dots" id="teamCarouselDots"></div>
    </div>
</section>

<script>
const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-9ZE-RHcbVh69G9Hrk8cM_gy6hDbYwHFM_fCFiMgR5-HyHEHq46yGsROD-0nmpOi-gc_6XWpJIMPx/pub?gid=0&single=true&output=csv';

function parseCSV(text) {
    return text.trim().split('\n').map(row => row.split(',').map(cell => cell.trim()));
}

const teamMembersTrack = document.getElementById('teamMembersTrack');
const prevTeamBtn = document.getElementById('prevTeamBtn');
const nextTeamBtn = document.getElementById('nextTeamBtn');
const teamCarouselDotsContainer = document.getElementById('teamCarouselDots');

let teamMembers = [];
let currentTeamPageIndex = 0;
let membersPerPage = 4;

function renderTeamCarouselPages() {
    membersPerPage = window.innerWidth <= 768 ? 1 : window.innerWidth <= 1024 ? 2 : 4;
    const pages = [];
    for (let i = 0; i < teamMembers.length; i += membersPerPage) {
        const membersGroup = teamMembers.slice(i, i + membersPerPage);
        const pageDiv = document.createElement('div');
        pageDiv.className = "flex justify-center w-full shrink-0";
        membersGroup.forEach(member => {
            const memberDiv = document.createElement('div');
            memberDiv.className = "team-member-card w-full md:w-1/2 lg:w-1/4 p-4 box-border";
            memberDiv.innerHTML = `
                <img src="${member.imageUrl}" alt="${member.name}" class="w-24 h-24 rounded-full mx-auto mb-4 object-cover border-4 border-indigo-500">
                <h3 class="text-xl font-bold">${member.name}</h3>
                <p class="text-sm font-semibold text-gray-600">${member.role}</p>
                <p class="text-xs text-gray-500 mt-1">${member.experience || ''}</p>
                <p class="text-gray-700 text-sm mt-2">${member.about}</p>
                ${member.linkedIn ? `<a href="${member.linkedIn}" target="_blank" class="text-indigo-600 text-sm underline block mt-2">LinkedIn</a>` : ''}
            `;
            pageDiv.appendChild(memberDiv);
        });
        pages.push(pageDiv);
    }
    teamMembersTrack.innerHTML = "";
    pages.forEach(page => teamMembersTrack.appendChild(page));
    teamMembersTrack.style.width = `${pages.length * 100}%`;
    Array.from(teamMembersTrack.children).forEach(child => child.style.width = `${100 / pages.length}%`);
    createTeamDots(pages.length);
    updateTeamCarousel();
}

function updateTeamCarousel() {
    const offset = -(currentTeamPageIndex * 100);
    teamMembersTrack.style.transform = `translateX(${offset}%)`;
    Array.from(teamCarouselDotsContainer.children).forEach((dot, index) => {
        dot.classList.toggle('active', index === currentTeamPageIndex);
    });
}

function createTeamDots(totalPages) {
    teamCarouselDotsContainer.innerHTML = "";
    for (let i = 0; i < totalPages; i++) {
        const dot = document.createElement('span');
        dot.className = "dot";
        if (i === currentTeamPageIndex) dot.classList.add('active');
        dot.addEventListener('click', () => {
            currentTeamPageIndex = i;
            updateTeamCarousel();
        });
        teamCarouselDotsContainer.appendChild(dot);
    }
}

function showNextTeamPage() {
    const totalPages = teamCarouselDotsContainer.children.length;
    currentTeamPageIndex = (currentTeamPageIndex + 1) % totalPages;
    updateTeamCarousel();
}

function showPrevTeamPage() {
    const totalPages = teamCarouselDotsContainer.children.length;
    currentTeamPageIndex = (currentTeamPageIndex - 1 + totalPages) % totalPages;
    updateTeamCarousel();
}

prevTeamBtn.addEventListener('click', showPrevTeamPage);
nextTeamBtn.addEventListener('click', showNextTeamPage);
window.addEventListener('resize', () => {
    currentTeamPageIndex = 0;
    renderTeamCarouselPages();
});

async function fetchTeamMembers() {
    teamMembersTrack.innerHTML = '<p class="p-8">Loading team members...</p>';
    try {
        const response = await fetch(GOOGLE_SHEET_CSV_URL);
        const csvText = await response.text();
        const rows = parseCSV(csvText);
        const headers = rows[0].map(h => h.toLowerCase());
        teamMembers = rows.slice(1).map(row => {
            const data = {};
            headers.forEach((key, idx) => {
                data[key] = row[idx] || '';
            });
            return {
                name: data['name'],
                role: data['role'],
                experience: data['experience'],
                about: data['about'],
                imageUrl: data['imageurl'] || 'https://via.placeholder.com/120?text=No+Image',
                linkedIn: data['linkedin']
            };
        });
        renderTeamCarouselPages();
    } catch (error) {
        teamMembersTrack.innerHTML = '<p class="p-8">Failed to load team data.</p>';
    }
}

document.addEventListener('DOMContentLoaded', fetchTeamMembers);
</script>
